<div id="tasks-table" class="overflow-x-auto"
     hx-get="{{ url_prefix ~ '/tasks/partials/table' }}"
     hx-trigger="load delay:10000ms once, every 60s"
     hx-request="queue:last"
     hx-swap="innerHTML">

  <table class="min-w-full divide-y divide-gray-100">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-3">
          <input id="select-all" type="checkbox"
                 onclick="document.querySelectorAll('input[name=&quot;row&quot;]').forEach(cb=>cb.checked=this.checked); gatherSelected()" />
        </th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID / Name</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trigger</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Next run</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Store</th>
        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>

    <tbody class="bg-white divide-y divide-gray-100">
      {% if not tasks %}
        <tr>
          <td colspan="6" class="px-6 py-10 text-center text-gray-500">
            No tasks yet.
          </td>
        </tr>
      {% else %}
        {% for t in tasks %}
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-3">
              <input type="checkbox" name="row" value="{{ t.id }}" onchange="gatherSelected()" />
            </td>

            <td class="px-4 py-3">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="font-mono text-[11px] break-all">{{ t.id }}</div>
                  <div class="text-gray-600 text-sm">{{ t.name or '-' }}</div>
                  <div class="mt-1 flex items-center gap-2">
                    {% if t.next_run_time %}
                      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] bg-green-50 text-green-700 border border-green-200">
                        <span class="h-1.5 w-1.5 rounded-full bg-green-500"></span> Scheduled
                      </span>
                    {% else %}
                      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] bg-yellow-50 text-yellow-700 border border-yellow-200">
                        <span class="h-1.5 w-1.5 rounded-full bg-yellow-500"></span> Paused
                      </span>
                    {% endif %}
                  </div>
                </div>
                <button type="button"
                        class="ml-auto inline-flex items-center gap-1 rounded-md border border-gray-200 px-2 py-1 text-[11px] text-gray-700 hover:bg-gray-50"
                        onclick="navigator.clipboard && navigator.clipboard.writeText('{{ t.id }}')">
                  <!-- copy icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h8v10H8zM6 17V7a2 2 0 012-2h6" />
                  </svg>
                  Copy ID
                </button>
              </div>
            </td>

            <td class="px-4 py-3">
              <span class="px-2 py-1 rounded-full border text-xs bg-white">{{ t.trigger }}</span>
            </td>

            <td class="px-4 py-3">
              <div class="text-sm">{{ t.next_run_time or '-' }}</div>
            </td>

            <td class="px-4 py-3">
              <span class="font-mono text-xs">{{ t.store }}</span>
            </td>

            <td class="px-4 py-3">
              <div class="flex flex-wrap gap-2 justify-end">
                <form hx-post="{{ t.id }}/run" hx-target="#tasks-table" hx-swap="innerHTML">
                  <button class="inline-flex items-center gap-1 rounded-lg bg-[#f06824] px-3 py-1.5 text-sm font-medium text-white hover:bg-[#e35d1e]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white/90" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M8 5v14l11-7z" />
                    </svg>
                    Run
                  </button>
                </form>

                {% if t.next_run_time %}
                <form hx-post="{{ t.id }}/pause" hx-target="#tasks-table" hx-swap="innerHTML">
                  <button class="inline-flex items-center gap-1 rounded-lg border border-yellow-300 bg-yellow-50 px-3 py-1.5 text-sm font-medium text-yellow-800 hover:bg-yellow-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6M14 9v6" />
                    </svg>
                    Pause
                  </button>
                </form>
                {% else %}
                <form hx-post="{{ t.id }}/resume" hx-target="#tasks-table" hx-swap="innerHTML">
                  <button class="inline-flex items-center gap-1 rounded-lg border border-green-300 bg-green-50 px-3 py-1.5 text-sm font-medium text-green-800 hover:bg-green-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M8 5v14l11-7z" />
                    </svg>
                    Resume
                  </button>
                </form>
                {% endif %}

                <form hx-post="{{ t.id }}/remove" hx-target="#tasks-table" hx-swap="innerHTML"
                      onsubmit="return confirm('Remove task?')">
                  <button class="inline-flex items-center gap-1 rounded-lg border border-red-300 bg-red-50 px-3 py-1.5 text-sm font-medium text-red-800 hover:bg-red-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 7h12M9 7v10m6-10v10M10 3h4a1 1 0 011 1v2H9V4a1 1 0 011-1z" />
                    </svg>
                    Remove
                  </button>
                </form>
              </div>
            </td>
          </tr>
        {% endfor %}
      {% endif %}
    </tbody>
  </table>
</div>
